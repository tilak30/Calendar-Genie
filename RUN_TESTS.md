#!/bin/bash
# How to Run Integration Tests

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘    Calendar-Genie Integration Test - How to Run           â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

echo "ğŸ“‹ Option 1: Run with pytest (recommended)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  # Install pytest if needed:"
echo "  pip install pytest"
echo ""
echo "  # Run the test file:"
echo "  pytest test_integration.py -v"
echo ""
echo "  # Run with output:"
echo "  pytest test_integration.py -v -s"
echo ""

echo "ğŸ“‹ Option 2: Run as standalone Python script"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  python test_integration.py"
echo ""

echo "ğŸ“‹ Option 3: Run with unittest"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  python -m unittest test_integration.py"
echo ""

echo "ğŸ“‹ WHAT THE TESTS CHECK"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  1ï¸âƒ£  OAuth Flow (GET /auth/google)"
echo "     âœ“ Returns 307 redirect"
echo "     âœ“ Creates session_id"
echo ""
echo "  2ï¸âƒ£  User Endpoint (GET /api/user)"
echo "     âœ“ Returns 200 OK"
echo "     âœ“ Returns user email and name"
echo ""
echo "  3ï¸âƒ£  Meeting Prep (POST /api/prep-meeting)"
echo "     âœ“ Creates meeting_session_id"
echo "     âœ“ Returns meeting details"
echo ""
echo "  4ï¸âƒ£  Chat Endpoint (POST /api/chat)"
echo "     âœ“ Returns 200 OK"
echo "     âœ“ Returns text/answer"
echo "     âœ“ Returns decision and reasoning"
echo "     âœ“ Returns sources (RAG + Web)"
echo "     âœ“ Returns audio_url (if available)"
echo ""
echo "  5ï¸âƒ£  Authentication (401 errors)"
echo "     âœ“ Rejects requests without session"
echo ""

echo "ğŸš€ QUICK START (copy & paste)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  # Terminal 1: Start the server"
echo "  cd /Users/debikad/Desktop/hacknyu"
echo "  MOCK_AUTH=true python server.py"
echo ""
echo "  # Terminal 2: Run the tests"
echo "  cd /Users/debikad/Desktop/hacknyu"
echo "  python test_integration.py"
echo ""

echo "ğŸ“Š EXPECTED OUTPUT"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  ============================================================"
echo "    Calendar-Genie Unified Backend - Integration Test"
echo "  ============================================================"
echo ""
echo "  1ï¸âƒ£  Testing mock OAuth flow..."
echo "     GET /auth/google -> 307 (redirect)"
echo "     âœ… Session created: abc123def456..."
echo ""
echo "  2ï¸âƒ£  Testing GET /api/user..."
echo "     GET /api/user -> 200"
echo "     âœ… User: Demo User (demo@example.com)"
echo ""
echo "  3ï¸âƒ£  Testing POST /api/prep-meeting..."
echo "     POST /api/prep-meeting -> 200"
echo "     âœ… Meeting session created: meeting_xyz..."
echo "     ğŸ“š Meeting: Advanced Data Structures - Lecture"
echo ""
echo "  4ï¸âƒ£  Testing POST /api/chat..."
echo ""
echo "     Sending: 'What is this meeting about?'"
echo "     POST /api/chat -> 200"
echo "     âœ… Response received (450 chars)"
echo "     ğŸ¯ Decision: rag - This is a direct question..."
echo "     ğŸ“š Sources: RAG=True, Web=True"
echo "     ğŸ’¬ Response: This is a lecture on Advanced Data..."
echo ""
echo "  5ï¸âƒ£  Testing authentication requirement..."
echo "     POST /api/prep-meeting (no auth) -> 401"
echo "     âœ… Correctly rejected unauthorized request"
echo ""
echo "  ============================================================"
echo "    âœ… All integration tests PASSED!"
echo "  ============================================================"
echo ""

echo "â“ TROUBLESHOOTING"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  Error: 'No module named server'"
echo "    â†’ Make sure you're in the right directory"
echo "    â†’ cd /Users/debikad/Desktop/hacknyu"
echo ""
echo "  Error: 'Connection refused'"
echo "    â†’ Server isn't running"
echo "    â†’ Start it: MOCK_AUTH=true python server.py"
echo ""
echo "  Error: 'No module named fastapi'"
echo "    â†’ Install dependencies: pip install -r requirements.txt"
echo ""
echo "  Tests timeout (slow)"
echo "    â†’ Normal - LLM calls take 3-5 seconds"
echo "    â†’ Wait for responses to complete"
echo ""

echo "ğŸ“š MORE INFO"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  API Docs:              http://localhost:8000/docs"
echo "  Server Code:           server.py"
echo "  Test Code:             test_integration.py"
echo "  Integration Tests:     test_unified_backend.sh (bash version)"
echo ""
echo "  Documentation:"
echo "    - README_UNIFIED_BACKEND.md"
echo "    - FRONTEND_INTEGRATION.md"
echo "    - ARCHITECTURE.md"
echo ""
echo "Done! Questions? Check the docs ğŸ“š"
echo ""
